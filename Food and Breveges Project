CREATE DATABASE FOOD;
USE FOOD;

DROP TABLE CITIES;
CREATE OR REPLACE TABLE CITIES(
CITY_ID varchar(20),
CITY VARCHAR(30),
TIER VARCHAR(30)
);

DROP TABLE RESPONDENT;
CREATE OR REPLACE TABLE RESPONDENT(
RESPONDENT_ID INT,
NAME VARCHAR(30),
AGE VARCHAR(20),
GENDER VARCHAR(40),
CITY_ID VARCHAR(30)
);

DROP TABLE SURVEY_RESPONSE;

CREATE OR REPLACE TABLE SURVEY_RESPONSE(
Response_ID INT,
Respondent_ID INT,
Consume_frequency VARCHAR(30),
Consume_time VARCHAR(80),
Consume_reason VARCHAR(80),
Heard_before VARCHAR(30),
Brand_perception VARCHAR(30),
General_perception VARCHAR(30),
Tried_before VARCHAR(30),
Taste_experience INT,
Reasons_preventing_trying VARCHAR(80),
Current_brands VARCHAR(80),
Reasons_for_choosing_brands VARCHAR(80),
Improvements_desired VARCHAR(80),
Ingredients_expected VARCHAR(80),
Health_concerns VARCHAR(30),
Interest_in_natural_or_organic VARCHAR(80),
Marketing_channels VARCHAR(80),
Packaging_preference VARCHAR(80),
Limited_edition_packaging VARCHAR(80),
Price_range VARCHAR(60),
Purchase_location VARCHAR(80),
Typical_consumption_situations VARCHAR(90));
);




CREATE OR REPLACE STORAGE integration s3_int
TYPE=EXTERNAL_STAGE
STORAGE_PROVIDER=S3
ENABLED=TRUE
STORAGE_AWS_ROLE_ARN='arn:aws:iam::233625266009:role/brevegesrole'
STORAGE_ALLOWED_LOCATIONS=('s3://breveges/');

DESC integration s3_int;  


CREATE OR REPLACE STAGE FOOD
URL='s3://breveges'
FILE_FORMAT=CSV
STORAGE_INTEGRATION=s3_int;

LIST@FOOD;

SHOW STAGES;

SHOW PIPES;




create or replace file format CSV
    type = 'csv' 
    compression = 'none' 
    field_delimiter = ','
    field_optionally_enclosed_by = 'none'
    skip_header = 1 ;

CREATE OR REPLACE PIPE BANK_SNOWPIPE_DISTRICT AUTO_INGEST = TRUE AS
COPY INTO "BANK"."PUBLIC"."DISTRICT" --yourdatabase -- your schema ---your table
FROM '@BANK/District/' --s3 bucket subfolde4r name
FILE_FORMAT = BANK_TESTING;

CREATE OR REPLACE PIPE FOOD_SNOWPIPE_CITIES AUTO_INGEST=TRUE AS
COPY INTO FOOD.PUBLIC.CITIES
FROM '@FOOD/CITIES/'
FILE_FORMAT=CSV;

CREATE OR REPLACE PIPE FOOD_SNOWPIPE_RESPONDENT AUTO_INGEST=TRUE AS
COPY INTO FOOD.PUBLIC.RESPONDENT
FROM '@FOOD/RESPONDENT/'
FILE_FORMAT=CSV;

CREATE OR REPLACE PIPE FOOD_SNOWPIPE_SURVEY AUTO_INGEST=TRUE AS
COPY INTO FOOD.PUBLIC.SURVEY_RESPONSE
FROM '@FOOD/SURVEY_RESPONSE/'
FILE_FORMAT=CSV;

ALTER PIPE FOOD_SNOWPIPE_CITIES REFRESH;

ALTER PIPE FOOD_SNOWPIPE_RESPONDENT REFRESH;

ALTER PIPE FOOD_SNOWPIPE_SURVEY REFRESH;

SELECT * FROM CITIES;

SELECT COUNT(*) FROM FOOD.PUBLIC.RESPONDENT;

SELECT COUNT(*) FROM FOOD.PUBLIC.SURVEY_RESPONSE;

SELECT * FROM FOOD.PUBLIC.RESPONDENT;

SELECT * FROM FOOD.PUBLIC.SURVEY_RESPONSE;




